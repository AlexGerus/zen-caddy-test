<form @verticalAccordion *ngIf="token && !completed" [formGroup]="form" (ngSubmit)="onSubmit()">
  <zen-loading *ngIf="loading"></zen-loading>

  <mat-form-field hideRequiredMarker appearance="outline" class="w-100 mb-2">
    <mat-label>Password</mat-label>
    <input matInput [type]="hidePassword ? 'password' : 'text'" [formControl]="password">
    <span mat-icon-button matSuffix (click)="hidePassword = !hidePassword" tabindex="-1" [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hidePassword">
      <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
    </span>
    <mat-error *ngIf="password.errors?.required">Required</mat-error>
    <mat-error *ngIf="password.errors?.incorrect">Incorrect password</mat-error>
    <mat-error *ngIf="password.errors?.minLength && !password.errors?.required">{{password.errors.minLength}}</mat-error>
    <mat-error *ngIf="password.errors?.maxLength && !password.errors?.required">{{password.errors.maxLength}}</mat-error>
  </mat-form-field>

  <mat-form-field hideRequiredMarker appearance="outline" class="w-100 mb-2">
    <mat-label>Confirm Password</mat-label>
    <input matInput [type]="hidePassword ? 'password' : 'text'" [formControl]="passwordConfirm" required>
    <span mat-icon-button matSuffix (click)="hidePassword = !hidePassword" tabindex="-1" [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hidePassword">
      <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
    </span>
    <mat-error *ngIf="passwordConfirm.errors?.required">Required</mat-error>
    <mat-error *ngIf="passwordConfirm.errors?.notMatching && !passwordConfirm.errors?.required">Password confirmation does not match</mat-error>
  </mat-form-field>

  <button type="submit" mat-raised-button color="primary" class="w-100 text-lg py-1" [disabled]="!form.valid">
    <i class="fas fa-fw fa-cloud-upload-alt mr-1"></i>
    Change Password
  </button>
</form>

<div @verticalAccordion *ngIf="generalError || !token" class="card">
  <div class="card-body text-center">
    <div class="mb-4">
      <mat-error>
        <i class="fas fa-exclamation-triangle fa-4x mb-4"></i>
        <br>
        There was a problem resolving your password reset request.
        Your password reset request may have expired.
        <br>
      </mat-error>
    </div>

    <button mat-stroked-button color="primary" routerLink="/password-reset-request" class="w-100 text-lg">
      <i class="fas fa-redo mr-2"></i>
      Click here to request a new one
    </button>
  </div>
</div>

<div @verticalAccordion *ngIf="completed" class="text-center">
  <mat-progress-bar mode="indeterminate" class="mb-3"></mat-progress-bar>

  <h4>Password successfully changed</h4>
  
  <h4>
    Redirecting in
    <i class="fas fa-spinner fa-spin"></i>
    5 seconds
  </h4>
  
  <button type="button" mat-raised-button color="primary" routerLink="/login" class="w-100">
    <i class="fas fa-key"></i>
    Login
  </button>
</div>