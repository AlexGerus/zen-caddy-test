<div class="container">
  <div *ngIf="token" class="row animated zoomInDown">
    <div class="col-lg-8 offset-lg-2 col-xl-6 offset-xl-3">
      <div class="card my-5">
        <div class="card-header">
          <h1 class="m-0">
            <i class="fas fa-fw fa-lock"></i>
            Password Reset
          </h1>
        </div>
        <div class="card-body">
          
          <form *ngIf="!completed" [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
            <zen-loading *ngIf="loading"></zen-loading>

            <div class="form-group" [ngClass]="{'has-danger': password.invalid && password.touched}">
              <input formControlName="password" type="password" placeholder="New Password" class="form-control"
              [ngClass]="{'is-invalid': password.invalid && password.touched}" maxlength="{{ApiConstants.PASSWORD_MAX_LENGTH}}" required>
              <div class="invalid-feedback" *ngIf="password.errors?.required">Required</div>
              <div class="invalid-feedback" *ngIf="password.errors?.minLength && !password.errors?.required">{{password.errors.minLength}}</div>
              <div class="invalid-feedback" *ngIf="password.errors?.maxLength && !password.errors?.required">{{password.errors.maxLength}}</div>
            </div>

            <div class="form-group" [ngClass]="{'has-danger': passwordConfirm.invalid && passwordConfirm.touched}">
              <input formControlName="passwordConfirm" type="password" placeholder="Confirm Password" class="form-control"
              [ngClass]="{'is-invalid': passwordConfirm.invalid && passwordConfirm.touched}" maxlength="{{ApiConstants.PASSWORD_MAX_LENGTH}}" required>
              <div class="invalid-feedback" *ngIf="passwordConfirm.errors?.required">Required</div>
              <div class="invalid-feedback" *ngIf="passwordConfirm.errors?.notMatching && !passwordConfirm.errors?.required">Password confirmation does not match</div>
            </div>

            <div class="text-center text-danger mb-3" *ngIf="generalError">
              There was a problem with your request. Your password reset request may have expired.<br>
              <a routerLink="/password-reset-request">Click here to request a new one.</a>
            </div>

            <div class="text-center" >
              <button type="submit" class="btn btn-info btn-lg btn-block"
              [ngClass]="{'cursor-pointer': passwordForm.valid, 'cursor-not-allowed': !passwordForm.valid}" [disabled]="!passwordForm.valid || loading">
                <i class="fas fa-fw fa-cloud-upload-alt"></i>
                Change Password
              </button>
            </div>
          </form>

          <div *ngIf="completed" class="animated zoomInDown text-center text-xl alert alert-primary">
            Password successfully changed.<br>
            Redirecting you to <a routerLink="/login">login</a> in 5 seconds.
            <i class="fas fa-spinner fa-spin"></i>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>