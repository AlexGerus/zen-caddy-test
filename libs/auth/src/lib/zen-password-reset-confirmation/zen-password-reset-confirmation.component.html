<form *ngIf="token && !completed" [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
  <zen-loading *ngIf="loading"></zen-loading>

  <div class="form-group" [ngClass]="{'has-danger': password.invalid && password.touched}">
    <input formControlName="password" type="password" placeholder="New Password" class="form-control"
    [ngClass]="{'is-invalid': password.invalid && password.touched}" maxlength="{{ApiConstants.PASSWORD_MAX_LENGTH}}">
    <div class="invalid-feedback" *ngIf="password.errors?.required">Required</div>
    <div class="invalid-feedback" *ngIf="password.errors?.minLength && !password.errors?.required">{{password.errors.minLength}}</div>
    <div class="invalid-feedback" *ngIf="password.errors?.maxLength && !password.errors?.required">{{password.errors.maxLength}}</div>
  </div>

  <div class="form-group" [ngClass]="{'has-danger': passwordConfirm.invalid && passwordConfirm.touched}">
    <input formControlName="passwordConfirm" type="password" placeholder="Confirm Password" class="form-control"
    [ngClass]="{'is-invalid': passwordConfirm.invalid && passwordConfirm.touched}" maxlength="{{ApiConstants.PASSWORD_MAX_LENGTH}}">
    <div class="invalid-feedback" *ngIf="passwordConfirm.errors?.required">Required</div>
    <div class="invalid-feedback" *ngIf="passwordConfirm.errors?.notMatching && !passwordConfirm.errors?.required">Password confirmation does not match</div>
  </div>

  <div class="text-center" >
    <button type="submit" class="btn btn-info btn-lg btn-block"
    [ngClass]="{'cursor-pointer': passwordForm.valid, 'cursor-not-allowed': !passwordForm.valid}" [disabled]="!passwordForm.valid || loading">
      <i class="fas fa-fw fa-cloud-upload-alt"></i>
      Change Password
    </button>
  </div>
</form>

<div @verticalAccordion *ngIf="generalError || !token" class="card">
  <div class="card-body text-center">
    <div class="mb-4">
      <mat-error>
        <i class="fas fa-exclamation-triangle fa-4x mb-4"></i>
        <br>
        There was a problem resolving your password reset request.
        Your password reset request may have expired.
        <br>
      </mat-error>
    </div>

    <button mat-stroked-button color="primary" routerLink="/password-reset-request" class="w-100 text-lg">
      <i class="fas fa-redo mr-2"></i>
      Click here to request a new one
    </button>
  </div>
</div>

<div *ngIf="completed" class="animated zoomInDown text-center text-xl alert alert-primary">
  Password successfully changed.<br>
  Redirecting you to <a routerLink="/login">login</a> in 5 seconds.
  <i class="fas fa-spinner fa-spin"></i>
</div>